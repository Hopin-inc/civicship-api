# Claude Code Project Skills System

civicship-apiの開発フローを支援する包括的なClaude Code Project Skillsシステムを導入します。20個のスキルを4つのフェーズに分けて実装し、要件定義からデプロイまでの全工程をカバーします。

## 🎯 概要

このPRは、DDD/Clean Architectureに基づくcivicship-apiプロジェクト向けに、開発ライフサイクル全体を支援する20個のClaude Code Skillsを追加します。全てのスキルは日本語で記述され、チームメンバーが即座に活用できる構成になっています。

**統計:**
- **20スキル** を追加（14,700行以上）
- **4フェーズ** に分類された体系的な構成
- **完全日本語対応** で可読性を最大化
- **メモリ最適化** （大規模スキルに `context: fork` を適用）

---

## 📋 追加されたスキル一覧

### 🏗️ 基盤スキル（アーキテクチャ・開発支援）

#### 1. `validate-architecture`
- **説明:** DDD/Clean Architecture準拠を検証
- **機能:** レイヤー違反、トランザクションパターン、RLS（Row-Level Security）の検証
- **用途:** コードレビュー前の自動チェック、アーキテクチャ原則の遵守確認

#### 2. `new-domain`
- **説明:** 新規ドメイン作成
- **機能:** DDD構造に従った完全なディレクトリ・ファイル生成、DI登録、GraphQLリゾルバ登録
- **用途:** 新機能開発時のボイラープレート生成、一貫性のある構造確保

#### 3. `db-migration`
- **説明:** データベースマイグレーション支援
- **機能:** Prismaスキーマ変更、マイグレーションファイル生成、ロールバック計画
- **用途:** 安全なスキーマ変更、データ移行計画の策定

---

### 🧪 品質保証スキル

#### 4. `test-domain`
- **説明:** ドメイン単位のテスト実行
- **機能:** ユニット・統合テストの実行、カバレッジ測定、テスト結果のサマリー
- **用途:** CI/CDパイプライン、ローカル開発時の品質確認

#### 5. `security-review`
- **説明:** セキュリティレビュー
- **機能:** OWASP Top 10脆弱性チェック、認証・認可の検証、機密情報漏洩検出
- **用途:** セキュリティ監査、本番デプロイ前のチェック

#### 6. `pr-review`
- **説明:** プルリクエストレビュー支援
- **機能:** コード品質チェック、アーキテクチャ違反検出、テスト網羅性確認
- **用途:** レビュープロセスの効率化、一貫した品質基準の適用

---

### 📝 Phase 1: Requirements Foundation（要件基盤）

#### 7. `elicit-requirements`
- **説明:** 要件定義を支援
- **機能:** 5W1Hフレームワーク、Given-When-Then受け入れ条件、既存システムとの整合性確認
- **用途:** 新機能開発の初期段階、要件の明確化

#### 8. `check-requirement-delta`
- **説明:** 要件の衝突を検出
- **機能:** 新要件と既存仕様の衝突分析、リスク評価マトリクス、対策提案
- **用途:** 要件定義レビュー、既存機能への影響評価

#### 9. `phased-delivery-plan`
- **説明:** 段階的リリース計画
- **機能:** 6フェーズのデリバリー戦略、フィーチャーフラグ設計、ロールバック計画
- **用途:** 大規模機能のリリース計画、段階的ロールアウト

---

### 🛡️ Phase 2: Safety & Compatibility（安全性・互換性）

#### 10. `map-impact-analysis`
- **説明:** 影響範囲を分析
- **機能:** 依存関係グラフ生成、3レベルの影響連鎖分析、テスト工数見積もり
- **用途:** リファクタリング前の影響評価、変更範囲の可視化

#### 11. `api-compatibility-check`
- **説明:** API互換性を検証
- **機能:** GraphQL破壊的変更検出、互換性スコア算出、移行計画策定
- **用途:** APIスキーマ変更時の後方互換性確認、クライアント影響評価

#### 12. `legacy-audit`
- **説明:** 技術的負債を評価
- **機能:** P0-P3優先度分類、Cyclomatic Complexity測定、N+1問題検出
- **用途:** リファクタリング優先度の決定、技術的負債の定量化

#### 13. `dependency-upgrade-path`
- **説明:** 依存更新計画を策定
- **機能:** セマンティックバージョニング分析、Breaking change検出、段階的アップグレード戦略
- **用途:** 安全な依存パッケージ更新、セキュリティ脆弱性対応

---

### 🔍 Phase 3: Requirements Refinement（要件詳細化）

#### 14. `side-effect-brainstorming`
- **説明:** 副作用の洗い出し
- **機能:** 20カテゴリの副作用分析、優先度評価マトリクス、影響シミュレーション
- **用途:** 変更による意図しない影響の特定、リスク低減策の検討

#### 15. `migration-requirements`
- **説明:** マイグレーション要件を策定
- **機能:** 詳細DDL手順、データ検証スクリプト、ロールバック計画
- **用途:** 安全なデータ移行、スキーマ変更の実行計画

#### 16. `infer-intent`
- **説明:** 設計意図を推測
- **機能:** Git履歴分析、コミットメッセージ解析、暗黙的制約の発見
- **用途:** レガシーコードの理解、設計判断の根拠把握

#### 17. `refinement-questionnaire`
- **説明:** 要件ギャップを特定
- **機能:** 20問の質問フォーマット、Critical/High/Medium/Low優先度分類
- **用途:** 要件の抜け漏れ防止、仕様の詳細化

---

### 📊 Phase 4: Operational Quality（運用品質）

#### 18. `analyze-performance`
- **説明:** パフォーマンス分析
- **機能:** N+1問題検出、クエリ最適化提案、パフォーマンススコア算出
- **用途:** パフォーマンスボトルネック特定、クエリ最適化

#### 19. `monitoring-readiness`
- **説明:** 監視要件定義
- **機能:** メトリクス設計、アラート設定、Grafana/Datadogダッシュボード設計
- **用途:** 本番監視の準備、SLO/SLI定義

#### 20. `performance-diff`
- **説明:** パフォーマンス比較
- **機能:** 変更前後の比較、リグレッション判定、マージ可否判断
- **用途:** パフォーマンスリグレッション検出、最適化効果の測定

---

## 🔧 技術的特徴

### アーキテクチャ統合
- **DDD/Clean Architecture完全対応**: 全スキルがcivicship-apiのレイヤー構造を理解
- **Prisma ORM統合**: RLS、トランザクションパターンの自動検証
- **GraphQL最適化**: DataLoaderによるN+1問題防止、スキーマ互換性チェック

### メモリ最適化
- **`context: fork`の戦略的適用**: 500行以上の大規模スキル（13個）に適用し、メモリ効率を向上
- **段階的実行**: 長時間実行タスクを複数ステップに分割

### 開発体験
- **完全日本語対応**: 全スキルが日本語で記述され、チームの理解を促進
- **豊富な例**: 各スキルにコードスニペット、SQL、GraphQL、TypeScriptの実例を含む
- **実践的フォーマット**: Given-When-Then、5W1H、優先度付けなど実務で使える形式

---

## 📦 コードレビュー対応

Copilot/Geminiのレビューフィードバックに基づき、以下の改善を実施:

### 一貫性の向上
- ✅ 全スキルの `description` を5-10文字に短縮（可読性向上）
- ✅ `context: fork` をPhase 1-2の大規模スキル（7ファイル）に追加
- ✅ プレースホルダー構文を `${...}` から `{{...}}` に統一（`new-domain`）

### 堅牢性の向上
- ✅ シェル変数に引用符を追加（`legacy-audit`で13箇所修正）
- ✅ `find` コマンドの括弧を標準エスケープに変更（`validate-architecture`）
- ✅ `allowed-tools` に不足していた `Bash` を追加（`monitoring-readiness`）

### 変更統計
```
10 files changed, 45 insertions(+), 38 deletions(-)
```

---

## 🚀 使用例

### 新機能開発フロー
```bash
# 1. 要件定義
/elicit-requirements ポイント有効期限機能

# 2. 要件衝突チェック
/check-requirement-delta ポイント有効期限機能

# 3. 段階的リリース計画
/phased-delivery-plan ポイント有効期限機能

# 4. 影響範囲分析
/map-impact-analysis wallet

# 5. ドメイン作成
/new-domain point-expiration reward

# 6. アーキテクチャ検証
/validate-architecture reward/point-expiration

# 7. パフォーマンス分析
/analyze-performance reward/point-expiration

# 8. 監視設定
/monitoring-readiness ポイント有効期限機能
```

### リファクタリングフロー
```bash
# 1. 技術的負債評価
/legacy-audit wallet

# 2. 影響範囲分析
/map-impact-analysis wallet

# 3. 依存関係更新
/dependency-upgrade-path prisma

# 4. パフォーマンス比較
/performance-diff wallet
```

---

## 📚 ドキュメント

各スキルの詳細な使用方法は、それぞれの `.claude/skills/*/SKILL.md` を参照してください。全てのスキルには以下が含まれます:
- **使用方法**: コマンド例と引数の説明
- **ステップバイステップのプロセス**: 詳細な実行手順
- **具体例**: 実際の使用シナリオとコードスニペット
- **ベストプラクティス**: 推奨される使い方と注意事項

---

## ✅ チェックリスト

- [x] 20個の全スキルを実装
- [x] 日本語ドキュメント完備
- [x] `context: fork` によるメモリ最適化
- [x] Copilot/Geminiレビュー対応
- [x] 一貫性の向上（description短縮、プレースホルダー統一）
- [x] シェルコマンドの堅牢性向上（引用符、エスケープ）
- [x] civicship-apiアーキテクチャとの完全統合

---

## 🎉 期待される効果

1. **開発速度の向上**: ボイラープレート生成、自動検証により開発時間を短縮
2. **品質の向上**: アーキテクチャ原則の自動チェック、一貫した品質基準の適用
3. **知識の共有**: 暗黙知を形式知化、チーム全体のスキル向上
4. **リスクの低減**: 影響範囲分析、副作用検出により予期せぬ問題を防止
5. **運用の安定化**: 監視設定、パフォーマンス分析により本番環境の品質を向上

https://claude.ai/code/session_018oyRs8Q7zxPSUDZWVhqXWx
