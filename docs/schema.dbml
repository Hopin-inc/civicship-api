//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table t_users {
  id String [pk]
  name String [not null]
  slug String [not null]
  image String
  bio String
  sysRole SysRole [not null, default: 'USER']
  urlWebsite String
  urlX String
  urlFacebook String
  urlInstagram String
  urlYoutube String
  urlTiktok String
  identities t_identities [not null]
  memberships t_memberships [not null]
  participations t_participations [not null]
  opportunitiesCreatedByMe t_opportunities [not null]
  opportunityInvitations t_opportunity_invitations [not null]
  opportunityInvitationHistories t_opportunity_invitation_histories [not null]
  participationStatusChangedByMe t_participation_status_histories [not null]
  articles t_articles [not null]
  wallets t_wallets [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_identities {
  uid String [pk]
  platform IdentityPlatform [not null]
  userId String [not null]
  user t_users [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_communities {
  id String [pk]
  name String [not null]
  pointName String [not null]
  image String
  bio String
  establishedAt DateTime
  website String
  memberships t_memberships [not null]
  opportunities t_opportunities [not null]
  participations t_participations [not null]
  wallets t_wallets [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  utility t_utilities [not null]
  article t_articles [not null]
}

Table t_memberships {
  userId String [not null]
  user t_users [not null]
  communityId String [not null]
  community t_communities [not null]
  status MembershipStatus [not null]
  role Role [not null, default: 'MEMBER']
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime

  indexes {
    (userId, communityId) [pk]
  }
}

Table t_wallets {
  id String [pk]
  type WalletType [not null, default: 'MEMBER']
  communityId String [not null]
  community t_communities [not null]
  userId String
  user t_users
  currentPointView mv_current_points
  accumulatedPointView mv_accumulated_points
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
  fromTransactions t_transactions [not null]
  toTransactions t_transactions [not null]
}

Table t_opportunities {
  id String [pk]
  title String [not null]
  description String [not null]
  body String
  category OpportunityCategory [not null]
  publishStatus PublishStatus [not null, default: 'PUBLIC']
  requireApproval Boolean [not null, default: false]
  capacity Int
  pointsRequired Int
  pointsToEarn Int
  feeRequired Int
  image String
  files Json [not null, default: '[]', note: '[ArrayOfString]']
  startsAt DateTime
  endsAt DateTime
  placeId String
  place t_places
  communityId String [not null]
  community t_communities [not null]
  createdBy String [not null]
  createdByUser t_users [not null]
  articles t_articles [not null]
  participations t_participations [not null]
  slots t_opportunity_slots [not null]
  invitations t_opportunity_invitations [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_opportunity_slots {
  id String [pk]
  startsAt DateTime [not null]
  endsAt DateTime [not null]
  opportunityId String
  opportunity t_opportunities
  participations t_participations [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_opportunity_invitations {
  id String [pk]
  code String [not null]
  isValid Boolean [not null, default: true]
  opportunityId String [not null]
  opportunity t_opportunities [not null]
  createdBy String [not null]
  createdByUser t_users [not null]
  histories t_opportunity_invitation_histories [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_opportunity_invitation_histories {
  id String [pk]
  invitationId String [not null]
  invitation t_opportunity_invitations [not null]
  invitedUserId String [not null]
  inivitedUser t_users [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_places {
  id String [pk]
  name String [not null]
  address String [not null]
  latitude Decimal [not null]
  longitude Decimal [not null]
  isManual Boolean [not null]
  googlePlaceId String
  mapLocation Json
  cityCode String [not null]
  city m_cities [not null]
  opportunities t_opportunities [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_participations {
  id String [pk]
  status ParticipationStatus [not null]
  images Json [note: '[ArrayOfImageInfo]']
  userId String
  user t_users
  communityId String
  community t_communities
  opportunityId String
  opportunity t_opportunities
  opportunitySlotId String
  opportunitySlot t_opportunity_slots
  statusHistories t_participation_status_histories [not null]
  transactions t_transactions [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_participation_status_histories {
  id String [pk]
  status ParticipationStatus [not null]
  participationId String [not null]
  participation t_participations [not null]
  createdBy String
  createdByUser t_users
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_articles {
  id String [pk]
  title String [not null]
  introduction String [not null]
  category ArticleCategory [not null]
  publishStatus PublishStatus [not null, default: 'PUBLIC']
  body String [not null]
  thumbnail Json [note: '[ImageInfo]']
  publishedAt DateTime [not null]
  communityId String [not null]
  community t_communities [not null]
  writtenByUserId String
  writtenByUser t_users
  opportunities t_opportunities [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_utilities {
  id String [pk]
  name String [not null]
  description String
  image String
  pointsRequired Int [not null]
  communityId String [not null]
  community t_communities [not null]
  transactions t_transactions [not null]
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table t_transactions {
  id String [pk]
  reason TransactionReason [not null]
  from String
  fromWallet t_wallets
  fromPointChange Int
  to String
  toWallet t_wallets
  toPointChange Int
  participationId String
  participation t_participations
  utilityId String
  utility t_utilities
  createdAt DateTime [default: `now()`, not null]
  updatedAt DateTime
}

Table m_cities {
  code String [pk]
  name String [not null]
  stateCode String [not null]
  countryCode String [not null]
  state m_states [not null]
  places t_places [not null]
}

Table m_states {
  code String [not null]
  name String [not null]
  countryCode String [not null]
  cities m_cities [not null]

  indexes {
    (code, countryCode) [pk]
  }
}

Table mv_current_points {
  walletId String [pk]
  currentPoint Int [not null]
  wallet t_wallets [not null]
}

Table mv_accumulated_points {
  walletId String [pk]
  accumulatedPoint Int [not null]
  wallet t_wallets [not null]
}

Table t_opportunities_on_articles {
  articlesId String [ref: > t_articles.id]
  opportunitiesId String [ref: > t_opportunities.id]
}

Enum IdentityPlatform {
  LINE
  FACEBOOK
}

Enum SysRole {
  SYS_ADMIN
  USER
}

Enum Role {
  OWNER
  MANAGER
  MEMBER
}

Enum PublishStatus {
  PUBLIC
  COMMUNITY_INTERNAL
  PRIVATE
}

Enum OpportunityCategory {
  QUEST
  EVENT
  ACTIVITY
}

Enum ArticleCategory {
  ACTIVITY_REPORT
  INTERVIEW
}

Enum MembershipStatus {
  INVITED
  CANCELED
  JOINED
  WITHDRAWED
}

Enum ParticipationStatus {
  INVITED
  APPLIED
  CANCELED
  PARTICIPATING
  NOT_PARTICIPATING
  APPROVED
  DENIED
}

Enum WalletType {
  COMMUNITY
  MEMBER
}

Enum TransactionReason {
  POINT_ISSUED
  PARTICIPATION_APPROVED
  UTILITY_USAGE
  MEMBERSHIP_DELETED
  GIFT
  OTHER
}

Ref: t_identities.userId > t_users.id [delete: Cascade]

Ref: t_memberships.userId > t_users.id [delete: Cascade]

Ref: t_memberships.communityId > t_communities.id [delete: Cascade]

Ref: t_wallets.communityId > t_communities.id [delete: Cascade]

Ref: t_wallets.userId > t_users.id [delete: Set Null]

Ref: t_opportunities.placeId > t_places.id [delete: Restrict]

Ref: t_opportunities.communityId > t_communities.id [delete: Cascade]

Ref: t_opportunities.createdBy > t_users.id [delete: Set Null]

Ref: t_opportunity_slots.opportunityId > t_opportunities.id [delete: Cascade]

Ref: t_opportunity_invitations.opportunityId > t_opportunities.id [delete: Set Null]

Ref: t_opportunity_invitations.createdBy > t_users.id [delete: Set Null]

Ref: t_opportunity_invitation_histories.invitationId > t_opportunity_invitations.id [delete: Cascade]

Ref: t_opportunity_invitation_histories.invitedUserId > t_users.id [delete: Cascade]

Ref: t_places.cityCode > m_cities.code [delete: Restrict]

Ref: t_participations.userId > t_users.id [delete: Set Null]

Ref: t_participations.communityId > t_communities.id [delete: Set Null]

Ref: t_participations.opportunityId > t_opportunities.id [delete: Set Null]

Ref: t_participations.opportunitySlotId > t_opportunity_slots.id [delete: Set Null]

Ref: t_participation_status_histories.participationId > t_participations.id [delete: Cascade]

Ref: t_participation_status_histories.createdBy > t_users.id [delete: Set Null]

Ref: t_articles.communityId > t_communities.id [delete: Cascade]

Ref: t_articles.writtenByUserId > t_users.id [delete: Set Null]

Ref: t_utilities.communityId > t_communities.id [delete: Cascade]

Ref: t_transactions.from > t_wallets.id [delete: Set Null]

Ref: t_transactions.to > t_wallets.id [delete: Set Null]

Ref: t_transactions.participationId > t_participations.id [delete: Set Null]

Ref: t_transactions.utilityId > t_utilities.id [delete: Set Null]

Ref: m_cities.(stateCode, countryCode) > m_states.(code, countryCode) [delete: Restrict]

Ref: mv_current_points.walletId - t_wallets.id

Ref: mv_accumulated_points.walletId - t_wallets.id